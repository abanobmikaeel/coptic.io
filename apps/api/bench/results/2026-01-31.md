# Coptic.IO Performance Benchmarks - 2026-01-31

## Summary

Build-time optimization phase:
1. **Pre-built synaxarium search index** - moved word indexing from runtime to build time
2. **Lazy index resolution** - resolve word→entries only during search, not at startup
3. **Deduplicated Coptic date conversions** - getFastingCalendar now converts once per day instead of 3x

## Final Results

### Throughput (Requests/Second)
  - Health: 15,101 req/s
  - Celebrations: 11,356 req/s
  - Fasting: 11,163 req/s
  - Readings: 10,250 req/s

### Latency (Single Request)
  - Fasting: 0.46ms
  - Readings: 0.55ms
  - Celebrations: 1.0ms
  - GraphQL: 3.45ms

## Comparison to Previous (2026-01-30)

| Endpoint | Previous | Current | Improvement |
|----------|----------|---------|-------------|
| **Latency** |
| Readings | 1.2ms | 0.55ms | **2.2x faster** |
| Fasting | 1.9ms | 0.46ms | **4x faster** |
| Celebrations | 5.4ms | 1.0ms | **5x faster** |
| GraphQL | 7.7ms | 3.45ms | **2.2x faster** |
| **Throughput (req/s)** |
| Health | 7,343 | 15,101 | **+106%** |
| Celebrations | 9,475 | 11,356 | +20% |
| Fasting | 11,704 | 11,163 | ~same |
| Readings | 10,838 | 10,250 | ~same |

## What Changed

### 1. Pre-built synaxarium search index (`@coptic/data`)
Moved word index generation from runtime to build time:
```typescript
// Before: Built at server startup (~4000 entries)
for (const [key, entries] of Object.entries(synaxariumReadings)) {
  // Parse, lowercase, build word index...
}

// After: Import pre-built JSON (224KB)
import { synaxariumIndex } from '@coptic/data/en'
const allEntries = indexData.entries  // Ready to use
```
- Build script: `pnpm --filter @coptic/data build:index`
- **Impact: Zero startup cost for synaxarium indexing**

### 2. Lazy index resolution
Resolve word→entry mappings only when searched, not at module load:
```typescript
// Before: Eager - resolve all words at startup
const wordIndex = new Map<string, IndexedEntry[]>()
for (const [word, indices] of Object.entries(indexData.wordIndex)) {
  wordIndex.set(word, indices.map(i => allEntries[i]))
}

// After: Lazy - resolve only searched words
const getEntriesForWord = (word: string): IndexedEntry[] => {
  const indices = wordIndex[word]
  if (!indices) return []
  return indices.map(i => allEntries[i])
}
```
- **Impact: Faster cold start, same search performance**

### 3. Deduplicated Coptic date conversions (`fasting.service.ts`)
```typescript
// Before: 3 conversions per day in getFastingCalendar
isInMoveableFast(date)           // internal conversion
getStaticCelebrationsForDay(date) // internal conversion
gregorianToCoptic(date)           // explicit conversion

// After: 1 conversion per day
const copticDate = gregorianToCoptic(date)  // once
isInMoveableFast(date)
getStaticCelebrationsForCopticDay(copticDate.month, copticDate.day)
```
- **Impact: 3x fewer date conversions per day**

## Cumulative Improvement (vs Original 2025-11-22)

| Endpoint | Original | Current | Total Speedup |
|----------|----------|---------|---------------|
| Readings | 1,675 req/s | 10,250 req/s | **6.1x** |
| Fasting | 3,376 req/s | 11,163 req/s | **3.3x** |
| Celebrations | 2,652 req/s | 11,356 req/s | **4.3x** |
| Health | 4,387 req/s | 15,101 req/s | **3.4x** |
